WrRmpi<-function(){
sink(paste(getwd(),"/Rmpi.R",sep=""))
cat(paste("load(paste(getwd(),",'"/tempMPI"',',sep=""))',sep=""))
cat("\r\n")
cat(paste("library(Rmpi",',lib.loc=.libPaths()[1])',sep=""))
cat("\r\n")
cat("myslave<-returnme$nshuffle-1")
#cat("myslave<-1")
cat("\r\n")
cat("mpi.spawn.Rslaves(nslaves=myslave,needlog=FALSE,quiet=TRUE)")
cat("\r\n")
cat(paste("mpi.bcast.cmd(load(paste(getwd(),",'"/tempMPI"',',sep="")))',sep=""))
cat("\r\n")
cat("mpi.bcast.cmd(library(Rmpi,lib.loc=.libPaths()[1]))")
cat("\r\n")
cat("mpi.bcast.cmd(myslave<-returnme$nshuffle-1)")
#cat("mpi.bcast.cmd(myslave<-1)")
cat("\r\n")
cat("x<-mpi.remote.exec(as.vector(randfun(procno=mpi.comm.rank(),COREobj=returnme,boundaries=boundaries,nprocs=myslave,rngoffset=0)))")
cat("\r\n")
cat("y<-unlist(x)")
cat("\r\n")
cat("gather.result <- mpi.allgather(y,type=2,rdata=numeric(length(y)*ncores),comm=0)")
cat("\r\n")
cat(paste(paste("save(gather.result,file=paste(getwd(),",'"/mygather.temp"',sep=""),',sep=""))',sep=""))
cat("\r\n")
cat("mpi.close.Rslaves(dellog=FALSE)")
cat("\r\n")
cat("mpi.quit()")
sink()
}
